<!DOCTYPE html>
<html lang="ko">
<head>
  <meta name="robots" content="index, follow">
  <meta name="description" content="ì†Œë‚™ì˜ ê°ë„ ë³´ì •ì‚¬ ğŸ¯ ë°°í‹€ê·¸ë¼ìš´ë“œ ê°ë„ ë¶„ì„ ë„êµ¬. ë§‰ì°½ìƒ·ì—ì„œ ë ˆì´ì €ê¹Œì§€, ê°ë„ ë¬¸ì œë¥¼ í•´ê²°í•˜ì„¸ìš”!">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì†Œë‚™ì˜ ê°ë„ ì¡°ì •ì‚¬</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #005F9E;
      --accent-color: #00A3E0;
      --bg-color: #F5F7FA;
      --card-bg: #FFFFFF;
      --text-color: #1A202C;
      --subtext-color: #6B7280;
      --border-radius: 12px;
      --spacing: 1.5rem;
      --shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    .site-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, #003F6B 100%);
      height: 5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      padding: 0 1rem;
    }
    .container {
      max-width: 800px;
      margin: var(--spacing) auto;
      padding: var(--spacing);
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }
    h1 { display: none; }
    h2 {
      font-size: 1.5rem;
      margin-top: 2rem;
      margin-bottom: var(--spacing);
      color: var(--text-color);
      font-weight: 600;
    }
    .form-group { margin-bottom: var(--spacing); }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-color);
    }
    input[type=number], select {
      width: 100%;
      padding: 0.875rem;
      border: 1px solid #D1D5DB;
      border-radius: var(--border-radius);
      background: #F9FAFB;
      font-size: 1rem;
      color: var(--text-color);
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input[type=number]:focus, select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 163, 224, 0.2);
    }
    .file-drop {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 2.5rem;
      border: 2px dashed #D1D5DB;
      border-radius: var(--border-radius);
      background: #F9FAFB;
      cursor: pointer;
      transition: border-color 0.3s, background 0.3s;
    }
    .file-drop.dragover {
      border-color: var(--accent-color);
      background: rgba(0, 163, 224, 0.1);
    }
    .plus-icon {
      font-size: 1.5rem;
      color: var(--subtext-color);
      margin-bottom: 0.75rem;
    }
    #file-list {
      margin-top: 0.75rem;
      color: var(--subtext-color);
      font-size: 0.95rem;
    }
    #preview-container {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 1.5rem;
    }
    .preview-thumb {
      position: relative;
      flex: 0 0 100px;
      height: 56px;
      border-radius: var(--border-radius);
      overflow: hidden;
      background: #000;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .preview-thumb video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.9;
    }
    .delete-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #EF4444;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      line-height: 20px;
      text-align: center;
      cursor: pointer;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: #B91C1C;
    }
    button {
      width: 100%;
      padding: 1rem;
      margin-top: var(--spacing);
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      background: var(--accent-color);
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: background 0.3s, transform 0.2s, box-shadow 0.2s;
    }
    button:disabled {
      background: #D1D5DB;
      cursor: not-allowed;
    }
    button:not(:disabled):hover {
      background: #0086B3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 163, 224, 0.3);
    }
    .form-group-inline {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .form-group-inline small {
      margin-top: 0.25rem;
      color: var(--subtext-color);
      font-size: 0.9rem;
    }
    .box {
      background: #F9FAFB;
      padding: var(--spacing);
      border-radius: var(--border-radius);
      border: 2px solid var(--accent-color);
      margin-top: var(--spacing);
      box-shadow: var(--shadow);
      transition: background 0.2s;
    }
    .box:hover {
      background: #E6F0FA;
    }
    #analysis-result {
      font-size: 1rem;
      color: var(--text-color);
    }
    .copy-btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: var(--primary-color);
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background 0.2s;
    }
    .copy-btn:hover {
      background: #003F6B;
    }
    .link-back {
      display: flex;
      justify-content: flex-end;
      margin-top: var(--spacing);
    }
    .link-back a {
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
    }
    .link-back a:hover {
      color: #0086B3;
    }
    .chart-container {
      margin-top: var(--spacing);
    }
    canvas {
      border-radius: var(--border-radius);
      background: #fff;
      box-shadow: var(--shadow);
    }
    .main-heading {
      font-size: 1.8rem;
      font-weight: 700;
      color: #fff;
      text-align: center;
      display: flex;
      align-items: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }
    .sub-heading {
      font-size: 0.95rem;
      font-weight: 400;
      color: #E6F0FA;
      text-align: center;
      margin-top: 0.25rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
      max-width: 100%;
    }
    .target-icon {
      background: var(--accent-color);
      border-radius: 6px;
      padding: 0.2rem 0.4rem;
      margin-left: 0.5rem;
      font-size: 1.5rem;
      display: inline-block;
      line-height: 1;
    }
    .side-note {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1.75rem;
      background: #E6F0FA;
      border: 2px solid var(--accent-color);
      border-radius: var(--border-radius);
      font-size: 0.95rem;
      color: var(--text-color);
      box-shadow: var(--shadow);
    }
    @media (max-width: 600px) {
      .site-header {
        height: 6rem;
      }
      .main-heading {
        font-size: 1.5rem;
      }
      .sub-heading {
        font-size: 0.85rem;
        margin-top: 0.5rem;
      }
      .target-icon {
        font-size: 1.2rem;
        padding: 0.15rem 0.3rem;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div style="display: flex; flex-direction: column; align-items: center;">
      <div class="main-heading">ì†Œë‚™ì˜ ê°ë„ ë³´ì •ì‚¬ <span class="target-icon">ğŸ¯</span></div>
      <div class="sub-heading">ë§‰ì°½ìƒ·ë“¤ ë“œë£¨ì™€, ë ˆì´ì €ë¡œ ê°€ì¦ˆì•„!</div>
    </div>
  </header>
  <div class="container">
    <h1>ì†Œë‚™ì˜ ê°ë„ ì¡°ì •ì‚¬</h1>
    <h2>ê¸°ë³¸ ê°ë„ ì„¤ì •</h2>
    <div class="form-group">
      <label for="dpi-input">í˜„ì¬ DPI</label>
      <select id="dpi-input">
        <option>400</option><option>800</option><option>1200</option><option>1800</option><option>3200</option>
      </select>
    </div>
    <div class="form-group form-group-inline">
      <div style="flex:1;">
        <label for="general-sens-input">ì¼ë°˜ ê°ë„</label>
        <input type="number" id="general-sens-input" value="50" min="0" step="0.1">
      </div>
      <div style="flex:1;">
        <label for="vertical-sens-input">ìˆ˜ì§ ê°ë„</label>
        <input type="number" id="vertical-sens-input" value="1" min="0" step="0.1">
      </div>
    </div>
    <div class="form-group form-group-inline">
      <div style="flex:1;">
        <label for="aim-sens-input">ì¡°ì¤€ ê°ë„</label>
        <input type="number" id="aim-sens-input" value="50" min="0" step="0.1">
      </div>
      <div style="flex:1;">
        <label for="scope-sens-input">ìŠ¤ì½”í”„ ëª¨ë“œ ê°ë„</label>
        <input type="number" id="scope-sens-input" value="50" min="0" step="0.1">
      </div>
    </div>

    <h2>ê²Œì„ ì˜ìƒ ì—…ë¡œë“œ</h2>
    <div id="file-drop-zone" class="file-drop">
      <span class="plus-icon">+</span>
      <div id="preview-container"></div>
      <p id="file-list">ìµœëŒ€ 5ê°œ ì˜ìƒ ì—…ë¡œë“œ ê°€ëŠ¥</p>
    </div>
    <input type="file" id="video-input" accept="video/*" multiple hidden>

    <button id="analyze-btn" disabled>ë¶„ì„ ì‹œì‘</button>

    <div class="form-group form-group-inline">
      <label><input type="checkbox" id="unlock-ratio"> ì œí•œ í•´ì œ</label>
      <small id="ratio-status">ê¸°ë³¸ ë¹„ìœ¨ 0.8~1.2 ì ìš© ì¤‘</small>
    </div>

    <div id="analysis-result" class="box" style="display:none;"></div>
    <div id="charts" class="chart-container" style="display:none;">
      <canvas id="spray-scatter"></canvas>
      <canvas id="recoil-chart"></canvas>
    </div>

    <aside class="side-note">
      <p>ê°ë„ ë³´ì •ì€ í•œ ë²ˆì˜ ê³„ì‚°ìœ¼ë¡œ ëë‚˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ë‹¤ì–‘í•œ ìƒí™©ì˜ ì˜ìƒì„ ì—…ë¡œë“œí•˜ê³ , ì‹¤ì œ ë³´ì •ê°’ìœ¼ë¡œ í”Œë ˆì´í•˜ë©° ìì‹ ì˜ ì†ì— ë§ëŠ” ê°ë„ë¥¼ ì°¾ì•„ê°€ëŠ” ë°˜ë³µ ê³¼ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì†Œë‚™ì˜ ê°ë„ ë³´ì •ì‚¬ëŠ” ë ˆì´ì € ìƒ·ì„ ì›í•˜ëŠ” ë¶„ë“¤ ì¤‘, ê°ë„ ì„¤ì •ì´ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ë³¸ì¸ì—ê²Œ ë§ì§€ ì•ŠëŠ” ë¶„ë“¤ì—ê²Œ ì˜ìƒ ê¸°ë°˜ì˜ ë¶„ì„ì„ í†µí•´ ë³´ì • ë°©í–¥ì„ ì œì‹œí•´ì£¼ëŠ” ì¡°ë ¥ìì…ë‹ˆë‹¤.</p>
    </aside>

    <div class="link-back">
      <a href="https://sonak-sens-master.vercel.app/">ê°ë„ê³„ì‚°ì´ ê¶ê¸ˆì“°? > ì†Œë‚™ì˜ ê°ë„ì‚¬ë¡œ ã„±ã„±!</a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const fileDrop = document.getElementById('file-drop-zone');
    const videoInput = document.getElementById('video-input');
    const fileList = document.getElementById('file-list');
    const previewContainer = document.getElementById('preview-container');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultDiv = document.getElementById('analysis-result');
    const chartsDiv = document.getElementById('charts');
    const generalInput = document.getElementById('general-sens-input');
    const verticalInput = document.getElementById('vertical-sens-input');
    const aimInput = document.getElementById('aim-sens-input');
    const scopeInput = document.getElementById('scope-sens-input');
    const unlockRatio = document.getElementById('unlock-ratio');
    const ratioStatus = document.getElementById('ratio-status');

    let fileArray = [];
    let cachedResult = null;
    let sprayChart = null;
    let recoilChart = null;

    function updateButton() {
      const inputsValid = generalInput.value && verticalInput.value && aimInput.value && scopeInput.value &&
                         Number(generalInput.value) >= 0 && Number(verticalInput.value) >= 0 &&
                         Number(aimInput.value) >= 0 && Number(scopeInput.value) >= 0;
      analyzeBtn.disabled = !(fileArray.length > 0 && fileArray.length <= 5 && inputsValid);
    }

    function updateFileList() {
      previewContainer.innerHTML = '';
      fileList.textContent = fileArray.length > 0 ? `${fileArray.length}ê°œ íŒŒì¼ ì„ íƒë¨` : 'ìµœëŒ€ 5ê°œ ì˜ìƒ ì—…ë¡œë“œ ê°€ëŠ¥';
      fileArray.forEach((file, index) => {
        const url = URL.createObjectURL(file);
        const thumbContainer = document.createElement('div');
        thumbContainer.className = 'preview-thumb';
        const thumb = document.createElement('video');
        thumb.src = url;
        thumb.muted = true;
        thumb.preload = 'metadata';
        thumb.playsInline = true;
        thumb.controls = false;
        thumb.autoplay = false;
        thumb.loop = false;
        thumb.addEventListener('loadeddata', () => thumb.currentTime = 0.1);
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'X';
        deleteBtn.onclick = () => {
          fileArray.splice(index, 1);
          const dt = new DataTransfer();
          fileArray.forEach(f => dt.items.add(f));
          videoInput.files = dt.files;
          updateFileList();
          updateButton();
        };
        thumbContainer.appendChild(thumb);
        thumbContainer.appendChild(deleteBtn);
        previewContainer.appendChild(thumbContainer);
      });
      updateButton();
    }

    function handleFiles(files) {
      const newFiles = Array.from(files).filter(file => !fileArray.some(f => f.name === file.name && f.size === f.size));
      fileArray = [...fileArray, ...newFiles].slice(0, 5);
      const dt = new DataTransfer();
      fileArray.forEach(f => dt.items.add(f));
      videoInput.files = dt.files;
      updateFileList();
    }

    videoInput.addEventListener('change', e => handleFiles(e.target.files));
    fileDrop.addEventListener('click', () => videoInput.click());
    fileDrop.addEventListener('dragover', e => { e.preventDefault(); fileDrop.classList.add('dragover'); });
    fileDrop.addEventListener('dragleave', () => fileDrop.classList.remove('dragover'));
    fileDrop.addEventListener('drop', e => { e.preventDefault(); fileDrop.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });

    function resetCache() {
      cachedResult = null;
      if (sprayChart) sprayChart.destroy();
      if (recoilChart) recoilChart.destroy();
      sprayChart = null;
      recoilChart = null;
      resultDiv.style.display = 'none';
      chartsDiv.style.display = 'none';
    }

    [generalInput, verticalInput, aimInput, scopeInput].forEach(input => {
      input.addEventListener('input', () => {
        resetCache();
        updateButton();
      });
    });

    unlockRatio.addEventListener('change', () => {
      resetCache();
      ratioStatus.textContent = unlockRatio.checked ? 'ì œí•œ í•´ì œ: ì› ë¹„ìœ¨ ì ìš©' : 'ê¸°ë³¸ ë¹„ìœ¨ 0.8~1.2 ì ìš© ì¤‘';
      updateButton();
    });

    analyzeBtn.addEventListener('click', () => {
      if (cachedResult) {
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = cachedResult;
        chartsDiv.style.display = 'block';
        return;
      }

      try {
        const demoY = Array.from({ length: 20 }, (_, i) => (Math.sin(i * 0.5) - 0.5) * 10);
        const absY = demoY.map(Math.abs);
        const meanY = absY.reduce((a,b)=>a+b)/absY.length;
        const demoX = Array.from({ length: 20 }, (_, i) => (Math.cos(i * 0.5) - 0.5) * 10);
        const absX = demoX.map(Math.abs);
        const meanX = absX.reduce((a,b)=>a+b)/absX.length;
        let ratio = ((2/meanX)+(2/meanY))/2;
        console.log('Calculated ratio:', ratio, 'Unlock checked:', unlockRatio.checked);
        if (!unlockRatio.checked) {
          ratio = Math.max(0.8, Math.min(1.2, ratio));
        }
        console.log('Final ratio:', ratio);

        const rec = v => {
          const result = (v * ratio).toFixed(2);
          return isNaN(result) ? '0.00' : result;
        };

        const resultHTML = `
          <strong>ì¶”ì²œ ê°ë„</strong><br>
          - ì¼ë°˜: ${rec(+generalInput.value)}<br>
          - ìˆ˜ì§: ${rec(+verticalInput.value)}<br>
          - ì¡°ì¤€: ${rec(+aimInput.value)}<br>
          - ìŠ¤ì½”í”„: ${rec(+scopeInput.value)}<br>
          <div class="copy-btn" onclick="copyResults()">ê²°ê³¼ ë³µì‚¬</div>
        `;
        cachedResult = resultHTML;
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = resultHTML;
        chartsDiv.style.display = 'block';

        if (sprayChart) sprayChart.destroy();
        if (recoilChart) recoilChart.destroy();

        sprayChart = new Chart('spray-scatter', {
          type: 'scatter',
          data: {
            datasets: [{
              label: 'ìŠ¤í”„ë ˆì´',
              data: Array.from({length: 50}, () => ({
                x: (Math.cos(Math.random() * Math.PI) - 0.5) * 20,
                y: (Math.sin(Math.random() * Math.PI) - 0.5) * 20
              })),
              backgroundColor: 'rgba(0, 163, 224, 0.6)'
            }]
          },
          options: {
            plugins: { title: { display: true, text: 'ìŠ¤í”„ë ˆì´ íŒ¨í„´' } },
            scales: {
              x: { title: { display: true, text: 'ìˆ˜í‰ í¸ì°¨' } },
              y: { title: { display: true, text: 'ìˆ˜ì§ í¸ì°¨' } }
            }
          }
        });

        recoilChart = new Chart('recoil-chart', {
          type: 'line',
          data: {
            labels: Array.from({length: 20}, (_, i) => i + 1),
            datasets: [
              { label: '|Î”Y|', data: absY, borderColor: '#00A3E0', fill: false },
              { label: '|Î”X|', data: absX, borderColor: '#005F9E', fill: false }
            ]
          },
          options: {
            plugins: { title: { display: true, text: 'ë¦¬ì½”ì¼ ë¶„ì„' } },
            scales: {
              x: { title: { display: true, text: 'í”„ë ˆì„' } },
              y: { title: { display: true, text: 'í¸ì°¨ í¬ê¸°' } }
            }
          }
        });
      } catch (err) {
        console.error('ë¶„ì„ ì˜¤ë¥˜:', err);
        alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì…ë ¥ ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
      }
    });

    function copyResults() {
      const text = `ì¼ë°˜: ${resultDiv.querySelectorAll('br')[1].previousSibling.textContent.split(': ')[1]}\n` +
                   `ìˆ˜ì§: ${resultDiv.querySelectorAll('br')[2].previousSibling.textContent.split(': ')[1]}\n` +
                   `ì¡°ì¤€: ${resultDiv.querySelectorAll('br')[3].previousSibling.textContent.split(': ')[1]}\n` +
                   `ìŠ¤ì½”í”„: ${resultDiv.querySelectorAll('br')[4].previousSibling.textContent.split(': ')[1]}`;
      
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(() => {
          alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }).catch(err => {
          console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.focus();
      textarea.select();
      try {
        document.execCommand('copy');
        alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } catch (err) {
        console.error('ëŒ€ì²´ ë³µì‚¬ ì‹¤íŒ¨:', err);
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. HTTPS í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
      }
      document.body.removeChild(textarea);
    }
  </script>
</body>
</html>
